# PIKE-RAG与AoT结合实施计划

本文档记录将PIKE-RAG异构图查询与AoT马尔可夫推理结合的实施计划，以及进一步改进的创新方案。

## 一、基础结合方案

### 1. 异构图增强的马尔可夫状态实现

- **文件路径**: `pikerag/workflows/aot_pike_workflow.py`
- **实现内容**: 创建AoTPikeWorkflow类，结合AoT的马尔可夫推理特性与PIKE-RAG的异构图检索机制
- **注意事项**:
  - 确保每个马尔可夫状态是自包含的，不依赖历史推理过程
  - 实现分解-收缩机制，将DAG中的子问题解答结果收缩为新的原子状态
  - 保持状态转换的答案等价性

### 2. 混合检索器实现

- **文件路径**: `pikerag/knowledge_retrievers/aot_pike_retriever.py`
- **实现内容**: 创建AoTPikeRetriever类，为DAG中的节点提供异构图检索能力
- **注意事项**:
  - 实现节点级别的检索策略，针对每个DAG节点进行优化
  - 支持多路径检索备份机制，确保检索的鲁棒性
  - 提供动态原子查询生成能力，增强检索覆盖面

### 3. AoT-PIKE提示模板

- **文件路径**: `pikerag/prompts/decomposition/aot_pike.py`
- **实现内容**: 创建用于DAG分解和子问题收缩的提示模板
- **注意事项**:
  - DAG分解模板应明确指导LLM创建依赖型有向无环图
  - 收缩模板应确保生成的新状态保持答案等价性
  - 优化模板以减少Token消耗，提高效率

### 4. 配置和集成

- **文件路径**: `pikerag/config/aot_pike_config.yaml`
- **实现内容**: 提供AoT-PIKE结合的配置文件
- **注意事项**:
  - 提供可配置参数，如最大迭代次数、子问题解答阈值等
  - 确保与现有PIKE-RAG组件的兼容性
  - 提供简单的切换机制，允许灵活选择推理方式

## 二、进阶改进方案

### 1. 记忆增强的马尔可夫状态

- **文件路径**: `pikerag/reasoners/memory_markov.py`
- **实现内容**: 实现记忆增强的马尔可夫状态管理器，保留关键信息
- **注意事项**:
  - 设计合理的重要性判断机制，避免保留过多无关信息
  - 保持状态的独立性，仅保留必要的记忆
  - 提供记忆与当前状态的整合机制

### 2. 多模态异构图增强

- **文件路径**: `pikerag/knowledge_retrievers/multimodal_graph.py`
- **实现内容**: 扩展异构图以支持多模态知识，如图像、表格等
- **注意事项**:
  - 设计多模态嵌入方法，支持跨模态检索
  - 实现模态权重动态调整机制，根据问题特性优化检索
  - 确保多模态信息的有效整合和表示

### 3. 基于知识图谱的推理校验

- **文件路径**: `pikerag/validators/kg_validator.py`
- **实现内容**: 实现基于知识图谱的推理结果验证机制
- **注意事项**:
  - 设计实体和关系提取方法，从推理结果中识别关键信息
  - 提供知识图谱查询接口，验证推理结果的正确性
  - 实现错误检测和修正建议生成机制

### 4. 多策略合并与投票机制

- **文件路径**: `pikerag/ensemble/strategy_voting.py`
- **实现内容**: 实现多种推理策略的合并与投票机制
- **注意事项**:
  - 支持不同推理方法的灵活加载和配置
  - 设计加权投票算法，综合考虑各策略的可靠性
  - 提供一致性检测机制，优化决策过程

### 5. 自我纠错机制

- **文件路径**: `pikerag/reasoners/self_correction.py`
- **实现内容**: 实现推理过程中的自我纠错能力
- **注意事项**:
  - 设计矛盾检测算法，识别推理中的逻辑或事实错误
  - 提供纠错提示生成机制，引导LLM修正错误
  - 实现纠错后的结果验证和整合方法

### 6. 可解释推理跟踪

- **文件路径**: `pikerag/utils/reasoning_tracer.py`
- **实现内容**: 实现推理过程的跟踪和可解释性报告生成
- **注意事项**:
  - 记录推理过程中的关键步骤和决策点
  - 跟踪证据使用情况，建立推理结果与证据的关联
  - 提供多种格式的可解释性报告生成方法

### 7. 增量学习与异构图优化

- **文件路径**: `pikerag/optimizers/graph_optimizer.py`
- **实现内容**: 实现基于使用情况的异构图增量优化
- **注意事项**:
  - 设计原子查询使用情况的统计机制
  - 实现高价值和低价值原子查询的识别方法
  - 提供异构图动态更新机制，优化检索效率

### 8. 协同推理与专家系统集成

- **文件路径**: `pikerag/reasoners/collaborative.py`
- **实现内容**: 实现多专家协同推理框架
- **注意事项**:
  - 设计专家分配机制，根据问题特性选择合适的专家
  - 实现子问题分解和分配策略
  - 提供结果整合机制，综合各专家的解答

### 9. 主动学习与持续优化

- **文件路径**: `pikerag/optimizers/active_learning.py`
- **实现内容**: 实现基于主动学习的系统持续优化机制
- **注意事项**:
  - 设计不确定样本收集策略，识别系统表现不佳的问题类型
  - 提供标注请求生成和处理机制
  - 实现模型更新和性能评估方法

## 三、实施路线图

### 第一阶段：基础结合（2周）

- 实现异构图增强的马尔可夫状态
- 开发混合检索器
- 创建AoT-PIKE提示模板
- 完成配置和集成

### 第二阶段：核心增强（3周）

- 实现记忆增强的马尔可夫状态
- 开发多策略合并与投票机制
- 实现自我纠错机制
- 添加可解释推理跟踪

### 第三阶段：高级特性（4周）

- 实现多模态异构图增强
- 添加基于知识图谱的推理校验
- 开发协同推理与专家系统集成
- 实现增量学习与异构图优化

### 第四阶段：系统优化（2周）

- 实现主动学习与持续优化
- 进行全面的性能测试和优化
- 完善文档和示例
- 部署监控和评估系统

## 四、测试和评估计划

### 功能测试

- **文件路径**: `tests/aot_pike/functional_tests/`
- **测试内容**: 验证各模块的基本功能和接口
- **注意事项**:
  - 测试DAG分解和收缩机制的正确性
  - 验证异构图检索的准确性和效率
  - 测试马尔可夫状态转换的有效性

### 集成测试

- **文件路径**: `tests/aot_pike/integration_tests/`
- **测试内容**: 验证各模块的协同工作能力
- **注意事项**:
  - 测试端到端的问题解答流程
  - 验证不同组件间的接口兼容性
  - 测试系统在各种异常情况下的鲁棒性

### 性能基准测试

- **文件路径**: `tests/aot_pike/benchmarks/`
- **测试内容**: 评估系统在各种基准数据集上的性能
- **注意事项**:
  - 与原始PIKE-RAG和AoT进行对比
  - 评估系统在不同类型问题上的表现
  - 测量计算资源使用情况和效率

## 五、团队分工建议

1.  **核心开发团队**
    - 负责基础结合方案的实现
    - 开发关键算法和接口
2.  **算法优化团队**
    - 负责记忆增强、自我纠错等高级功能
    - 优化算法性能和资源使用
3.  **知识工程团队**
    - 负责异构图、知识图谱等知识相关组件
    - 优化知识表示和检索方法
4.  **测试与评估团队**
    - 负责功能测试和性能评估
    - 收集反馈并提出改进建议

# PIKE-RAG 项目计划与进度

## 已完成项目

1.  修复导入错误
    - 在 pikerag/workflows/**init**.py 中将 QAWorkflow 改为 QaWorkflow 以匹配实际的类名
    - 修复了从 pikerag.workflows.qa 导入 QAWorkflow 时的错误
2.  **创建适配器模块**
    - ☒ 创建`minirag_adapter.py`，用于连接pikeRAG和miniRAG
    - ☒ 实现实体抽取和关系构建功能
    - ☒ 实现图查询功能
    - ☒ 实现结果转换功能
3.  **创建增强版检索器**
    - ☒ 创建`enhanced_pike_retriever.py`，扩展AoTPikeRetriever
    - ☒ 实现文档处理功能
    - ☒ 实现融合检索功能
    - ☒ 重写DAG节点检索功能
    - ☒ 添加统计信息功能
4.  **创建增强版工作流**
    - ☒ 创建`enhanced_aot_pike_workflow.py`，扩展AoTPikeWorkflow
    - ☒ 重写节点问题回答功能
    - ☒ 添加文档处理功能
    - ☒ 实现过滤功能
5.  **创建配置文件模板**
    - ☒ 创建检索器配置模板
    - ☒ 创建工作流配置模板
6.  **创建使用示例**
    - ☒ 创建示例脚本
    - ☒ 添加示例文档和问题
7.  **创建文档**
    - ☒ 创建README文件
    - ☒ 记录使用方法和工作原理

## 待完成项目

1.  **测试和优化**
    - ☐ 测试不同图存储后端
    - ☐ 优化实体抽取性能
    - ☐ 优化图查询性能
2.  **扩展功能**
    - ☐ 添加更多图存储后端支持
    - ☐ 实现更复杂的图查询算法
    - ☐ 添加图可视化功能
3.  **集成到主分支**
    - ☐ 提交代码审查
    - ☐ 合并到主分支
    - ☐ 更新主文档
